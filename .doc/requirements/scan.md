# 静态代码检测

### 一.概述

​	静态代码分析是指在不运行代码的方式下，通过词法分析、语法分析、控制流、数据流分析等技术对程序代码进行扫描的技术。它的目的是验证代码是否满足规范性、安全性、可靠性、可维护性的要求。在一次构建的代码被编译部署之前，对仓库中的代码进行扫描并且将检查结果通过可视化页面展示

### 二.工具选择

​	SonarQube Scanner For Jenkins

​	SonarQube Server(7.9.x:lts)

​	SonarQube DataBase(Postgres:latetst)

### 三.功能点

#### 1.通过CI触发的静态代码检查的配置

​	静态代码检查是测试管理模块的一部分，主要还是作为流水线的一部分来实现自己的价值。这可以通过Jenkins插件[SonarQube Scanner for Jenkins](https://plugins.jenkins.io/sonar)来实现
新建流水线时，用户需配置以下内容：
>（1）语言类型(Java、Python、JavaScript...)
>
>（2）扫描工具
>
>（3）扫描级别(扫描全部缺陷、扫描中高级缺陷、扫描高级缺陷)
>
>（4）扫描红线即质量阀，不满足质量阀要求即任务失败(忽略所有缺陷、存在高危缺陷时任务失败...)
>
>（5）过滤，设置只扫描或者不扫描的文件路径
>
>（6）通知，设置任务启动/任务成功/任务失败时发送邮件给代码提交者/CI触发人

#### 2.手动触发的扫描

​	用户可以不需要通过流水线来完成一次快速扫描

​	新建一次快速扫描时，用户需配置以下内容

> （1）任务名称
>
> （2）扫描方式(扫描代码库、扫描文件)
>
> （3）扫描代码库时需要提供Git路径、Git账号和密码，扫描文件时上传文件
>
> （4）语言类型
>
> （5）过滤，设置只扫描或者不扫描的文件路径

#### 3.查看静态扫描结果

​	通过任务列表界面查看每次静态代码扫描的情况，并查看每次静态代码扫描的详情页面

#### 4.规则集的管理

##### 	4.1 新建规则集合

​	 用户可以新建规则集，这样可以用于对某一类特定问题的检测

##### 	4.2 查看详细规则信息

​	用户可以查看每一条规则的详细信息

#### 5.质量阀的设定

​	质量阀是任务成功失败的评价标准，用户可以设定质量阀，当扫描结果不满足质量阀要求时需要通知代码提交者和CI触发者

### 四.与其他模块的关系

#### 1.用户管理、组织层级

​	静态代码扫描需要调用用户及其组织信息，当扫描成功/失败时需要通知相应的代码提交者/CI触发者/项目负责人

#### 2.权限管理

​	普通的开发人员是没有权限设定质量阀的，因此质量阀的设定需要权限管理模块的配合

### 五.功能点分析

|                       用户故事                       |        功能点        |  M   |  S   |  C   |  W   |        约束        | 估时/人日 |
| :--------------------------------------------------: | :------------------: | :--: | :--: | :--: | :--: | :----------------: | :-------: |
| 作为用户，我希望能够在CI流水线中添加静态代码扫描任务 | 创建静态代码扫描任务 |  Y   |      |      |      |                    |     2     |
|                                                      |       查看任务       |  Y   |      |      |      |                    |     1     |
|                                                      |       删除任务       |  Y   |      |      |      |                    |     1     |
|            作为用户，我希望能编辑扫描规则            |     查看规则信息     |  Y   |      |      |      | 用户管理、权限管理 |     2     |
|                                                      |      新建规则集      |  Y   |      |      |      |                    |     2     |
|                                                      |      删除规则集      |  Y   |      |      |      |                    |    1.5    |
|                                                      |      编辑规则集      |  Y   |      |      |      |                    |    1.5    |
|      作为用户，我希望能够知道静态代码扫描的结果      |     查看扫描结果     |  Y   |      |      |      |                    |     4     |
|                                                      |       邮件通知       |  Y   |      |      |      |      消息服务      |     3     |
|         作为用户，我希望能够进行一次快速扫描         |   创建快速扫描任务   |  Y   |      |      |      |                    |    0.5    |
|                                                      |      扫描代码库      |  Y   |      |      |      |      git url       |     1     |
|                                                      |       扫描文件       |  Y   |      |      |      |      文件上传      |     3     |
|            作为用户，我希望能够设定质量阀            |      创建质量阀      |  Y   |      |      |      | 用户管理、权限管理 |     2     |
|                                                      |      修改质量阀      |  Y   |      |      |      | 用户管理、权限管理 |     2     |
|                                                      |      删除质量阀      |  Y   |      |      |      | 用户管理、权限管理 |     1     |

