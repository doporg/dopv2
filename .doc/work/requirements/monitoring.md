# 监控模块

## 变更记录

| 修改编号 | 版本 | 修改内容 | 修改人 | 修改日期 |
|-----|-----|-----|-----|-----|
| 01 | v1.0 | 初始版本 | 童正阳 | 2020-02-22 |

## 1 需求概述

随着分布式和微服务架构的落地和快速发展，服务器越来越多，中间件、应用、微服务、数据库等也越来越多样化，监控成为微服务系统的关键部分。非微服务架构下，单点应用定位问题相对来说是比较容易；但是服务多了之后，微服务之间互相的接口调用、服务部署的节点出现问题都需要快速定位。若微服务运行在容器当中，我们同样要考虑容器本身的监控，以及容器的日志监控。同时，监控模块也是告警模块的前置项。

## 2 功能点介绍

### 2.1 获取监控数据

获取以下监控数据，并支持可视化和搜索：
* 基础数据： 当前平台的网关 API、当前服务数、当前实例数、中间件；
* 外部请求数：显示 24h 内有多少请求访问网关，及访问后的状态码分析和满意度（平均响应时间）统计；
* 外部 IP 数：显示 24h 内来源的 IP 数及每个事件刻度下 IP 数；
* 平台告警：显示 24h 内告警总次数；
* 所属服务：当前实例属于哪一个服务的运行体；
* 实例名称：实例的 instanceId 信息；
* 实例状态：实例的 status ，包含：UP、DOWN；
* 运行时长：当前时间距离实例注册开始时间的时间差；
* 内存使用：已使用的内存/被分配的内存。

## 3 与其他模块的关系

### 3.1 API 网关服务

需要依赖 API 网关服务提供的获取所有微服务对外 API 的接口。

### 3.2 告警模块

需要为告警模块提供查询监控数据的接口。

## 4 功能点分析

| 用户故事 | 功能点 | M | S | C | W | 约束 | 估时/人日 |
|:---:|:---:|:--: | :--: | :---: | :--: | :---: |:--: |
| 作为用户，我希望能够获取的监控数据 | 基础数据 |Y| | | | |5|
| | 外部请求数 |Y| | | ||3|
| | 外部 IP 数 |Y| | | | |2|
| | 平台告警 |Y| | | | |2|
| | 所属服务 |Y|| | | |3|
| | 实例名称 |Y| | | | |2|
| | 实例状态 |Y| | | | |2|
| | 运行时长 |Y| | | | |2|
| | 内存使用 |Y| | | | |2|